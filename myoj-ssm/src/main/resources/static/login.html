<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>登录页面</title>
    <link rel="stylesheet" href="/layui/css/layui.css"/>
    <style>
        body {
            background-image: url("/image/BackgroundImage.jpg");
            background-size: cover;
        }
        .user-login-container {
            width: 320px;
            height: 100vh;
            display: grid;
            margin: auto auto 0;
            align-content: center;
        }

        .user-login-other .layui-icon {
            position: relative;
            display: inline-block;
            margin: 0 2px;
            top: 2px;
            font-size: 26px;
        }

        .user-reg-container {
            width: 320px;
            height: 100vh;
            display: grid;
            margin: auto auto 0;
            align-content: center;
        }

        .user-reg-other .layui-icon {
            position: relative;
            display: inline-block;
            margin: 0 2px;
            top: 2px;
            font-size: 26px;
        }
    </style>
</head>
<body>
<!--登录容器-->
<form class="layui-form">
    <div class="user-login-container layui-anim">
        <div class="layui-form-item">
            <div class="layui-input-wrap">
                <div class="layui-input-prefix">
                    <i class="layui-icon layui-icon-username"></i>
                </div>
                <input
                        type="text"
                        name="username"
                        value=""
                        lay-verify="required"
                        placeholder="用户名"
                        lay-reqtext="请填写用户名"
                        autocomplete="off"
                        class="layui-input"
                        lay-affix="clear"
                />
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-wrap">
                <div class="layui-input-prefix">
                    <i class="layui-icon layui-icon-password"></i>
                </div>
                <input
                        type="password"
                        name="password"
                        value=""
                        lay-verify="required"
                        placeholder="密   码"
                        lay-reqtext="请填写密码"
                        autocomplete="off"
                        class="layui-input"
                        lay-affix="eye"
                />
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-row">
                <div class="layui-col-xs7">
                    <div class="layui-input-wrap">
                        <div class="layui-input-prefix">
                            <i class="layui-icon layui-icon-vercode"></i>
                        </div>
                        <input
                                type="text"
                                name="captcha"
                                value=""
                                lay-verify="required"
                                placeholder="验证码"
                                lay-reqtext="请填写验证码"
                                autocomplete="off"
                                class="layui-input"
                                lay-affix="clear"
                        />
                    </div>
                </div>
                <div class="layui-col-xs5">
                    <div style="margin-left: 10px">
                        <img
                                src="https://www.oschina.net/action/user/captcha"
                                onclick="this.src='https://www.oschina.net/action/user/captcha?t='+ new Date().getTime();"
                        />
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <input
                    type="checkbox"
                    name="remember"
                    lay-skin="primary"
                    title="记住密码"
            />
            <a href="#forget" style="float: right; margin-top: 7px">忘记密码？</a>
        </div>
        <div class="layui-form-item">
            <button
                    class="layui-btn layui-btn-fluid"
                    lay-submit
                    lay-filter="user-login"
            >
                登录
            </button>
        </div>
        <div class="layui-form-item user-login-other">
            <label>社交账号登录</label>
            <span style="padding: 0 21px 0 6px">
            <a href="javascript:;"
            ><i
                    class="layui-icon layui-icon-login-qq"
                    style="color: #3492ed"
            ></i
            ></a>
            <a href="javascript:;"
            ><i
                    class="layui-icon layui-icon-login-wechat"
                    style="color: #4daf29"
            ></i
            ></a>
            <a href="javascript:;"
            ><i
                    class="layui-icon layui-icon-login-weibo"
                    style="color: #cf1900"
            ></i
            ></a>
          </span>
            或 <a id="register-a" href="#">注册帐号</a>
        </div>
    </div>
</form>

<!--注册容器-->
<form class="layui-form">
    <div class="user-reg-container layui-anim" style="display: none">
        <div class="layui-form-item">
            <div class="layui-row">
                <div class="layui-col-xs7">
                    <div class="layui-input-wrap">
                        <div class="layui-input-prefix">
                            <i class="layui-icon layui-icon-email"></i>
                        </div>
                        <input type="text" name="email" value="" lay-verify="required|email" placeholder="邮箱" lay-reqtext="请填写手机号" autocomplete="off" class="layui-input" id="reg-email">
                    </div>
                </div>
                <div class="layui-col-xs5">
                    <div style="margin-left: 11px;">
                        <button type="button" class="layui-btn layui-btn-fluid layui-btn-primary" lay-on="reg-get-vercode">获取验证码</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-wrap">
                <div class="layui-input-prefix">
                    <i class="layui-icon layui-icon-vercode"></i>
                </div>
                <input type="text" name="vercode" value="" lay-verify="required" placeholder="验证码" lay-reqtext="请填写验证码" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-wrap">
                <div class="layui-input-prefix">
                    <i class="layui-icon layui-icon-password"></i>
                </div>
                <input type="password" name="password" value="" lay-verify="required" placeholder="密码"
                       autocomplete="off" class="layui-input" id="reg-password" lay-affix="eye">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-wrap">
                <div class="layui-input-prefix">
                    <i class="layui-icon layui-icon-password"></i>
                </div>
                <input type="password" name="confirmPassword" value="" lay-verify="required|confirmPassword"
                       placeholder="确认密码" autocomplete="off" class="layui-input" lay-affix="eye">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-wrap">
                <div class="layui-input-prefix">
                    <i class="layui-icon layui-icon-username"></i>
                </div>
                <input type="text" name="nickname" value="" lay-verify="required" placeholder="昵称" autocomplete="off"
                       class="layui-input" lay-affix="clear">
            </div>
        </div>
        <div class="layui-form-item">
            <input type="checkbox" name="agreement" lay-verify="required" lay-skin="primary" title="同意">
            <a href="#terms" target="_blank" style="position: relative; top: 6px; left: -15px;">
                <ins>用户协议</ins>
            </a>
        </div>
        <div class="layui-form-item">
            <button class="layui-btn layui-btn-fluid" lay-submit lay-filter="user-reg">注册</button>
        </div>
        <div class="layui-form-item user-reg-other">
            <label>社交账号注册</label>
            <span style="padding: 0 21px 0 6px;">
        <a href="javascript:;"><i class="layui-icon layui-icon-login-qq" style="color: #3492ed;"></i></a>
        <a href="javascript:;"><i class="layui-icon layui-icon-login-wechat" style="color: #4daf29;"></i></a>
        <a href="javascript:;"><i class="layui-icon layui-icon-login-weibo" style="color: #cf1900;"></i></a>
      </span>
            <a id="login-a" href="#">登录已有帐号</a>
        </div>
    </div>
</form>

<script src="/layui/layui.js"></script>
<script>
    layui.use('jquery', function (){
        let $ = layui.jquery;
        let loginContainer = $(".user-login-container");
        let registerContainer = $(".user-reg-container");
        let animName = 'layui-anim-scale';

        $("#register-a").click(function (){
            loginContainer.hide();
            registerContainer.show();
            registerContainer.removeClass(animName);
            setTimeout(function(){
                registerContainer.addClass(animName);
            });
        });

        $("#login-a").click(function (){
            registerContainer.hide();
            loginContainer.show();
            loginContainer.removeClass(animName);
            setTimeout(function(){
                loginContainer.addClass(animName);
            });
        });
    });

    // 登录
    layui.use(['jquery', 'form', 'layer'], function () {
        let $ = layui.jquery;
        var form = layui.form;
        var layer = layui.layer;

        // 提交事件
        form.on("submit(user-login)", function (data) {
            var field = data.field; // 获取表单字段值
            // 此处可执行 Ajax 等操作
            $.ajax({
                url: "/user/login",
                type: "post",
                data: field,
                success: function (result) {
                    if (
                        result != null &&
                        result.code === 200 &&
                        result.data != null
                    ) {
                        layer.msg("登录成功" + JSON.stringify(result.data), {icon: 6});
                    } else if (result != null && result.msg === 'captcha error') {
                        layer.msg("请检查验证码", {icon: 2});
                    } else if (result != null && result.msg === 'illegal username or password') {
                        layer.msg("请检查用户名或者密码", {icon: 2});
                    } else {
                        layer.alert("登录失败，请稍后重试", {icon: 2});
                    }
                },
            });
            return false; // 阻止默认 form 跳转
        });
    });

    // 注册
    layui.use(['jquery', 'form', 'layer', 'util'], function () {
        var $ = layui.$;
        var form = layui.form;
        var layer = layui.layer;
        var util = layui.util;

        // 自定义验证规则
        form.verify({
            // 确认密码
            confirmPassword: function (value, item) {
                var passwordValue = $('#reg-password').val();
                if (value !== passwordValue) {
                    return '两次密码输入不一致';
                }
            }
        });

        // 提交事件
        form.on('submit(user-reg)', function (data) {
            var field = data.field; // 获取表单字段值

            // 是否勾选同意
            if (!field.agreement) {
                layer.msg('您必须勾选同意用户协议才能注册');
                return false;
            }
            $.ajax({
                url: "/user/register",
                type: "post",
                data: field,
                success: function (result) {
                    if (result != null && result.code === 200 && result.data != null) {
                        layer.msg("注册成功" + result.data, {icon: 1});
                    } else {
                        layer.alert("注册失败，请稍后重试", {icon: 2});
                    }
                }
            });
            return false; // 阻止默认 form 跳转
        });

        // 普通事件
        util.on('lay-on', {
            // 获取验证码
            'reg-get-vercode': function (othis) {
                var isvalid = form.validate('#reg-email'); // 主动触发验证，v2.7.0 新增
                // 验证通过
                if (isvalid) {
                    layer.msg('手机号规则验证通过');
                    // 此处可继续书写「发送验证码」等后续逻辑
                    // …
                }
            }
        });
    });
</script>
</body>
</html>
