<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>博客详情</title>
    <link rel="stylesheet" href="css/common.css" />
    <link rel="stylesheet" href="css/blog_detail.css" />
    <!-- 引入 editor.md 的依赖 -->
    <link rel="stylesheet" href="editor.md/css/editormd.min.css" />
    <script src="js/jquery.min.js"></script>
    <!-- <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script> -->
    <script src="editor.md/editormd.js"></script>
    <script src="editor.md/lib/marked.min.js"></script>
    <script src="editor.md/lib/prettify.min.js"></script>
  </head>
  <body>
    <div class="nav">
      <img src="images/logo.jpg" alt="导航栏图片" />
      <span class="title">我的博客系统</span>
      <div class="spacer"></div>
      <a href="blog_list.html">主页</a>
      <a href="blog_create.html">写博客</a>
      <a href="javascript:logout()">注销</a>
    </div>

    <div class="container">
      <div class="container-left">
        <div class="card">
          <img src="images/ProfilePicture.jpg" alt="头像" />
          <h3 id="username"></h3>
          <a href="#">github地址</a>
          <div class="counter">
            <span>文章</span>
            <span>分类</span>
          </div>
          <div class="counter">
            <span id="article-total"></span>
            <span>1</span>
          </div>
        </div>
      </div>
      <div class="container-right">
        <div class="blog-detail">
          <h3 id="title" class="title"></h3>
          <div class="info">
            发布于：<span id="update-time"></span> &nbsp;&nbsp; 阅读量：<span
              id="read-count"
            ></span>
          </div>
          <div id="content" class="content"></div>
        </div>
      </div>
    </div>

    <script>
      var editormd;
      function initEditor(md) {
        editormd = editormd.markdownToHTML("content", {
          markdown: md, // Also, you can dynamic set Markdown text
          // htmlDecode : true,  // Enable / disable HTML tag encode.
          // htmlDecode : "style,script,iframe",  // Note: If enabled, you should filter some dangerous HTML tags for website security.
        });
      }

      // 获取当前 url 参数的公共方法
      function getUrlValue(key) {
        let params = location.search;
        if (params.length > 1) {
          params = params.substring(1);
          let paramArr = params.split("&");
          for (let i = 0; i < paramArr.length; i++) {
            let kv = paramArr[i].split("=");
            if (kv[0] == key) {
              return kv[1];
            }
          }
        }
        return "";
      }

      function showArticleInfo(id) {
        if (id == "") {
          alert("illegal parameter");
          return;
        }
        jQuery.ajax({
          url: "/article/showinfo",
          type: "post",
          data: { id: id },
          success: function (result) {
            if (result != null && result.code == 200) {
              jQuery("#title").html(result.data.title);
              jQuery("#update-time").html(result.data.updateTime);
              jQuery("#read-count").html(result.data.rcount);
              initEditor(result.data.content);
              // editormd.markdownToHTML('content', {markdown: result.data.content});
              showUserInfoById(result.data.uid);
            } else {
              alert("获取文章信息失败");
            }
          },
        });
      }
      showArticleInfo(getUrlValue("id"));

      function showUserInfoById(id) {
        if (id == "") {
          alert("illegal parameter");
          return;
        }
        jQuery.ajax({
          url: "/user/showinfobyid",
          type: "post",
          data: { id: id },
          success: function (result) {
            if (result != null && result.code == 200 && result.data.id > 0) {
              jQuery("#username").html(result.data.username);
              jQuery("#article-total").html(result.data.articleTotal);
            } else {
              alert("获取用户信息失败");
            }
          },
        });
      }
    </script>
  </body>
</html>
