<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>博客详情</title>
    <link rel="stylesheet" href="css/common.css" />
    <link rel="stylesheet" href="css/blog_detail.css" />
    <link rel="stylesheet" href="editor.md/css/editormd.min.css" />
    <script src="js/jquery.min.js"></script>
    <script src="editor.md/editormd.js"></script>
    <script src="editor.md/lib/marked.min.js"></script>
    <script src="editor.md/lib/prettify.min.js"></script>
    <script src="js/common.js"></script>
  </head>
  <body>
    <div class="nav-wrapper"></div>
    <div class="container">
      <div class="container-left">
        <div class="card">
          <img id="photo" src="" alt="头像" />
          <h3 id="username"></h3>
          <a id="code-cloud" href="" target="_blank">代码云地址</a>
          <div class="counter">
            <span>文章</span>
            <span>分类</span>
          </div>
          <div class="counter">
            <span id="article-total"></span>
            <span>1</span>
          </div>
        </div>
      </div>
      <div class="container-right">
        <div class="blog-detail">
          <h3 id="title" class="title"></h3>
          <div class="info">
            发布于：<span id="create-time"></span> &nbsp;&nbsp; 更新于：<span
              id="update-time"
            ></span>
            &nbsp;&nbsp; 阅读量：<span id="read-count"></span>
          </div>
          <div id="content" class="content"></div>
        </div>
      </div>
    </div>

    <script>
      var editormd;
      function initEditor(md) {
        editormd = editormd.markdownToHTML("content", {
          markdown: md, // Also, you can dynamic set Markdown text
          // htmlDecode : true,  // Enable / disable HTML tag encode.
          // htmlDecode : "style,script,iframe",  // Note: If enabled, you should filter some dangerous HTML tags for website security.
        });
      }

      // 获取当前 url 参数的公共方法
      function getUrlValue(key) {
        let params = location.search;
        if (params.length > 1) {
          params = params.substring(1);
          let paramArr = params.split("&");
          for (let i = 0; i < paramArr.length; i++) {
            let kv = paramArr[i].split("=");
            if (kv[0] == key) {
              return kv[1];
            }
          }
        }
        return "";
      }
      

      function showArticleInfo(id) {
        if (id == "") {
          alert("illegal parameter");
          return;
        }
        $.ajax({
          url: "/article/showinfoaddrcount",
          type: "post",
          data: { id: id },
          success: function (result) {
            if (result != null && result.code == 200) {
              $("#title").html(result.data.title);
              $("#create-time").html(result.data.createTime);
              $("#update-time").html(result.data.updateTime);
              $("#read-count").html(result.data.rcount);
              initEditor(result.data.content);
              // editormd.markdownToHTML('content', {markdown: result.data.content});
              showUserInfoById(result.data.uid);
            } else {
              alert("获取文章信息失败");
            }
          },
        });
      }
      showArticleInfo(getUrlValue("id"));

      function showUserInfoById(id) {
        if (id == "") {
          alert("illegal parameter");
          return;
        }
        $.ajax({
          url: "/user/showinfobyid",
          type: "post",
          data: { id: id },
          success: function (result) {
            if (result != null && result.code == 200 && result.data.id > 0) {
              $("#username").text(result.data.username);
              $("#code-cloud").attr("href", result.data.codeCloud);
              $("#article-total").text(result.data.articleTotal);
              $("#photo").attr("src", result.data.photo);
            } else {
              alert("获取用户信息失败");
            }
          },
        });
      }
    </script>
  </body>
</html>
