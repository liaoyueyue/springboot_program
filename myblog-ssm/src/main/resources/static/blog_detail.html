<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>博客详情</title>
    <link rel="stylesheet" href="css/common.css" />
    <link rel="stylesheet" href="css/blog_detail.css" />
    <link rel="stylesheet" href="editor.md/css/editormd.min.css" />
    <script src="js/jquery.min.js"></script>
    <script src="editor.md/editormd.js"></script>
    <script src="editor.md/lib/marked.min.js"></script>
    <script src="editor.md/lib/prettify.min.js"></script>
    <script src="js/common.js"></script>
  </head>
  <body>
    <div class="nav-wrapper"></div>
    <div class="container">
      <div class="container-left">
        <div class="card">
          <img id="photo" src="" alt="头像" />
          <h3 id="username"></h3>
          <a id="code-cloud" href="" target="_blank">代码云地址</a>
          <div class="counter">
            <span>文章</span>
            <span>分类</span>
          </div>
          <div class="counter">
            <span id="article-total"></span>
            <span>1</span>
          </div>
        </div>
      </div>
      <div class="container-right">
        <div class="blog-detail">
          <h3 id="title" class="title"></h3>
          <div class="info">
            发布于：<span id="create-time"></span> &nbsp;&nbsp; 更新于：<span
              id="update-time"
            ></span>
            &nbsp;&nbsp; 阅读量：<span id="read-count"></span>
          </div>
          <div id="content" class="content"></div>
          <div id="comment-open-div">
            <div style="margin-left: 15px; cursor: pointer">> 10条评论</div>
            <button id="open-comment" class="comment-btn">写评论</button>
          </div>
        </div>
      </div>
    </div>
    <div id="open-comment-container" class="modal-wrapper">
      <div class="modal-content-right">
        <span class="close">&times;</span>
        <h2>评论 12</h2>
        <br />
        <hr />
        <div class="comment-box">
          <textarea
            class="comment-content"
            placeholder="在这里评论"
            maxlength="1000"
          ></textarea>
          <div class="comment-operate-box">
            <button id="comment-submit" class="comment-btn">评论</button>
          </div>
        </div>
        <div class="comment-list">
          <div class="comment-wrapper">
            <div class="comment">
              <a class="comment-left" href="">
                <img src="images/logo.jpg" alt="" />
              </a>
              <div class="comment-right">
                <div class="user-box">
                  <div class="name-href">
                    <span class="name">张三</span>
                  </div>
                  <div class="date">2小时前</div>
                </div>
                <div class="content">不错的，继续努力</div>
              </div>
            </div>
          </div>
          <div class="comment-wrapper">
            <div class="comment">
              <a class="comment-left" href="">
                <img src="images/logo.jpg" alt="" />
              </a>
              <div class="comment-right">
                <div class="user-box">
                  <div class="name-href">
                    <span class="name">李四</span>
                  </div>
                  <div class="date">8小时前</div>
                </div>
                <div class="content">写的太好了，终于知道了</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // 初始化editor编辑器
      var editormd;
      function initEditor(md) {
        editormd = editormd.markdownToHTML("content", {
          markdown: md, // Also, you can dynamic set Markdown text
          // htmlDecode : true,  // Enable / disable HTML tag encode.
          // htmlDecode : "style,script,iframe",  // Note: If enabled, you should filter some dangerous HTML tags for website security.
        });
      }

      //初始化评论模态框
      var modal = $("#open-comment-container");
      var closeBtn = $(".modal-content-right .close");
      $("#open-comment").click(function () {
        modal.css("display", "block");
      });
      $(window).click(function (event) {
        if (event.target == modal[0] || event.target == closeBtn[0]) {
          modal.css("display", "none");
        }
      });

      function showArticleInfo(id) {
        if (id == "") {
          alert("illegal parameter");
          return;
        }
        $.ajax({
          url: "/article/showinfoaddrcount",
          type: "post",
          data: { id: id },
          success: function (result) {
            if (result != null && result.code == 200) {
              $("#title").html(result.data.title);
              $("#create-time").html(result.data.createTime);
              $("#update-time").html(result.data.updateTime);
              $("#read-count").html(result.data.rcount);
              initEditor(result.data.content);
              // editormd.markdownToHTML('content', {markdown: result.data.content});
              showUserInfoById(result.data.uid);
            } else {
              alert("获取文章信息失败");
            }
          },
        });
      }
      showArticleInfo(getUrlValue("id"));

      function showUserInfoById(id) {
        if (id == "") {
          alert("illegal parameter");
          return;
        }
        $.ajax({
          url: "/user/showinfobyid",
          type: "post",
          data: { id: id },
          success: function (result) {
            if (result != null && result.code == 200 && result.data.id > 0) {
              $("#username").text(result.data.username);
              $("#code-cloud").attr("href", result.data.codeCloud);
              $("#article-total").text(result.data.articleTotal);
              $("#photo").attr("src", result.data.photo);
            } else {
              alert("获取用户信息失败");
            }
          },
        });
      }

      // 获取当前 url 参数的公共方法
      function getUrlValue(key) {
        let params = location.search;
        if (params.length > 1) {
          params = params.substring(1);
          let paramArr = params.split("&");
          for (let i = 0; i < paramArr.length; i++) {
            let kv = paramArr[i].split("=");
            if (kv[0] == key) {
              return kv[1];
            }
          }
        }
        return "";
      }
    </script>
  </body>
</html>
